<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>编写自定义源 | </title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.d704c10f.js"><link rel="modulepreload" href="/assets/custom-source.html.2d0eea50.js"><link rel="modulepreload" href="/assets/custom-source.html.7fb7efc8.js"><link rel="prefetch" href="/assets/index.html.cb293119.js"><link rel="prefetch" href="/assets/docs.html.f422bd6a.js"><link rel="prefetch" href="/assets/index.html.491898ea.js"><link rel="prefetch" href="/assets/program.html.6ae1044c.js"><link rel="prefetch" href="/assets/index.html.19943a35.js"><link rel="prefetch" href="/assets/index.html.0bce9513.js"><link rel="prefetch" href="/assets/package.html.860a6e7b.js"><link rel="prefetch" href="/assets/docs.html.f7b4d830.js"><link rel="prefetch" href="/assets/index.html.df47d8d2.js"><link rel="prefetch" href="/assets/index.html.eec15653.js"><link rel="prefetch" href="/assets/index.html.2716b1da.js"><link rel="prefetch" href="/assets/desktop.html.af72a10e.js"><link rel="prefetch" href="/assets/mobile.html.6b408fb7.js"><link rel="prefetch" href="/assets/hotkey.html.9e451f88.js"><link rel="prefetch" href="/assets/index.html.a3252c06.js"><link rel="prefetch" href="/assets/run-params.html.183d6ad9.js"><link rel="prefetch" href="/assets/scheme-url.html.06e34090.js"><link rel="prefetch" href="/assets/desktop.html.5f969b52.js"><link rel="prefetch" href="/assets/mobile.html.ae6912b1.js"><link rel="prefetch" href="/assets/hotkey.html.9de73d69.js"><link rel="prefetch" href="/assets/index.html.8c5881e5.js"><link rel="prefetch" href="/assets/run-params.html.8ba491ff.js"><link rel="prefetch" href="/assets/scheme-url.html.d985ef79.js"><link rel="prefetch" href="/assets/desktop.html.90bbe15e.js"><link rel="prefetch" href="/assets/desktop.html.22b2959f.js"><link rel="prefetch" href="/assets/mobile.html.df64a676.js"><link rel="prefetch" href="/assets/change-list-position.html.49418ff9.js"><link rel="prefetch" href="/assets/list-multiple-selection.html.d0a197ef.js"><link rel="prefetch" href="/assets/list-play-all.html.50c5414d.js"><link rel="prefetch" href="/assets/open-songlist.html.baa277c1.js"><link rel="prefetch" href="/assets/playlist.html.2e1a8c27.js"><link rel="prefetch" href="/assets/search-play-all.html.e3edda6c.js"><link rel="prefetch" href="/assets/desktop-lyric.html.2fdb3cb0.js"><link rel="prefetch" href="/assets/velocity-text.html.f89e0905.js"><link rel="prefetch" href="/assets/antivirus-software.html.83de613c.js"><link rel="prefetch" href="/assets/cannot-connect-internet.html.506afa7d.js"><link rel="prefetch" href="/assets/headphones-turn-off-unexpectedly.html.3dd2f978.js"><link rel="prefetch" href="/assets/interface-abnormal.html.d2a2bbcc.js"><link rel="prefetch" href="/assets/cannot-play-download.html.2f138e1d.js"><link rel="prefetch" href="/assets/download.html.572bb5d2.js"><link rel="prefetch" href="/assets/revise-dns-host.html.5376f622.js"><link rel="prefetch" href="/assets/custom-source.html.7af8f1b2.js"><link rel="prefetch" href="/assets/use-source.html.83c6d26f.js"><link rel="prefetch" href="/assets/backup.html.a1606072.js"><link rel="prefetch" href="/assets/sync.html.330b889c.js"><link rel="prefetch" href="/assets/cannot-update.html.062268b4.js"><link rel="prefetch" href="/assets/install-failed.html.2e19a916.js"><link rel="prefetch" href="/assets/package.html.511e216a.js"><link rel="prefetch" href="/assets/change-list-position.html.16d89e86.js"><link rel="prefetch" href="/assets/list-multiple-selection.html.4d9b58a3.js"><link rel="prefetch" href="/assets/list-play-all.html.bc41411f.js"><link rel="prefetch" href="/assets/open-songlist.html.9f02b6c9.js"><link rel="prefetch" href="/assets/playlist.html.d0d32007.js"><link rel="prefetch" href="/assets/search-play-all.html.bf0f35e0.js"><link rel="prefetch" href="/assets/desktop-lyric.html.b7f7d69e.js"><link rel="prefetch" href="/assets/velocity-text.html.0cf0773d.js"><link rel="prefetch" href="/assets/antivirus-software.html.d20396ce.js"><link rel="prefetch" href="/assets/cannot-connect-internet.html.56151be2.js"><link rel="prefetch" href="/assets/headphones-turn-off-unexpectedly.html.86a481f6.js"><link rel="prefetch" href="/assets/interface-abnormal.html.48dead95.js"><link rel="prefetch" href="/assets/cannot-play-download.html.eea6d3ea.js"><link rel="prefetch" href="/assets/download.html.7c94954a.js"><link rel="prefetch" href="/assets/revise-dns-host.html.143e3bcc.js"><link rel="prefetch" href="/assets/use-source.html.2fa157eb.js"><link rel="prefetch" href="/assets/backup.html.9032cf85.js"><link rel="prefetch" href="/assets/sync.html.2b793b69.js"><link rel="prefetch" href="/assets/cannot-update.html.5b713f96.js"><link rel="prefetch" href="/assets/install-failed.html.23b0696b.js"><link rel="prefetch" href="/assets/package.html.c75c9253.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/index.html.c0a6bc98.js"><link rel="prefetch" href="/assets/docs.html.5c9c58e0.js"><link rel="prefetch" href="/assets/index.html.5a586620.js"><link rel="prefetch" href="/assets/program.html.3ff8457c.js"><link rel="prefetch" href="/assets/index.html.7c189a6d.js"><link rel="prefetch" href="/assets/index.html.f7381f2c.js"><link rel="prefetch" href="/assets/package.html.7ef6dcaa.js"><link rel="prefetch" href="/assets/docs.html.c3222dfb.js"><link rel="prefetch" href="/assets/index.html.e4b5ae76.js"><link rel="prefetch" href="/assets/index.html.ca344fb0.js"><link rel="prefetch" href="/assets/index.html.cb107d0d.js"><link rel="prefetch" href="/assets/desktop.html.a1ed070a.js"><link rel="prefetch" href="/assets/mobile.html.18354f4a.js"><link rel="prefetch" href="/assets/hotkey.html.a208d85b.js"><link rel="prefetch" href="/assets/index.html.2eb880af.js"><link rel="prefetch" href="/assets/run-params.html.71bb8f72.js"><link rel="prefetch" href="/assets/scheme-url.html.b6c16224.js"><link rel="prefetch" href="/assets/desktop.html.89856815.js"><link rel="prefetch" href="/assets/mobile.html.15e1fdf5.js"><link rel="prefetch" href="/assets/hotkey.html.7ad24bf3.js"><link rel="prefetch" href="/assets/index.html.8fa6f7b3.js"><link rel="prefetch" href="/assets/run-params.html.f3b6f70f.js"><link rel="prefetch" href="/assets/scheme-url.html.42b2aeb0.js"><link rel="prefetch" href="/assets/desktop.html.10b436c1.js"><link rel="prefetch" href="/assets/desktop.html.dbb40700.js"><link rel="prefetch" href="/assets/mobile.html.71d7c488.js"><link rel="prefetch" href="/assets/change-list-position.html.c7bae603.js"><link rel="prefetch" href="/assets/list-multiple-selection.html.8f80d415.js"><link rel="prefetch" href="/assets/list-play-all.html.3abd83ae.js"><link rel="prefetch" href="/assets/open-songlist.html.fe124c05.js"><link rel="prefetch" href="/assets/playlist.html.76cb89bc.js"><link rel="prefetch" href="/assets/search-play-all.html.7caed375.js"><link rel="prefetch" href="/assets/desktop-lyric.html.d124a637.js"><link rel="prefetch" href="/assets/velocity-text.html.99569ad4.js"><link rel="prefetch" href="/assets/antivirus-software.html.f8949e0b.js"><link rel="prefetch" href="/assets/cannot-connect-internet.html.57bfca05.js"><link rel="prefetch" href="/assets/headphones-turn-off-unexpectedly.html.c37b83e6.js"><link rel="prefetch" href="/assets/interface-abnormal.html.2449ed1f.js"><link rel="prefetch" href="/assets/cannot-play-download.html.61084120.js"><link rel="prefetch" href="/assets/download.html.ca86bddb.js"><link rel="prefetch" href="/assets/revise-dns-host.html.fc9d6e3f.js"><link rel="prefetch" href="/assets/custom-source.html.50c1dc15.js"><link rel="prefetch" href="/assets/use-source.html.6199918a.js"><link rel="prefetch" href="/assets/backup.html.9fe62339.js"><link rel="prefetch" href="/assets/sync.html.02e624f8.js"><link rel="prefetch" href="/assets/cannot-update.html.6fda9e8a.js"><link rel="prefetch" href="/assets/install-failed.html.d7a492e2.js"><link rel="prefetch" href="/assets/package.html.7aee5706.js"><link rel="prefetch" href="/assets/change-list-position.html.814d67f1.js"><link rel="prefetch" href="/assets/list-multiple-selection.html.ab6fcf84.js"><link rel="prefetch" href="/assets/list-play-all.html.f6edc599.js"><link rel="prefetch" href="/assets/open-songlist.html.ec0dd0b3.js"><link rel="prefetch" href="/assets/playlist.html.f48e4d3a.js"><link rel="prefetch" href="/assets/search-play-all.html.e077a697.js"><link rel="prefetch" href="/assets/desktop-lyric.html.6b25754e.js"><link rel="prefetch" href="/assets/velocity-text.html.2b928ee7.js"><link rel="prefetch" href="/assets/antivirus-software.html.6c495170.js"><link rel="prefetch" href="/assets/cannot-connect-internet.html.be4e184c.js"><link rel="prefetch" href="/assets/headphones-turn-off-unexpectedly.html.97d5a74c.js"><link rel="prefetch" href="/assets/interface-abnormal.html.15d7d9fc.js"><link rel="prefetch" href="/assets/cannot-play-download.html.ee637041.js"><link rel="prefetch" href="/assets/download.html.c43e55c2.js"><link rel="prefetch" href="/assets/revise-dns-host.html.d4b1219f.js"><link rel="prefetch" href="/assets/use-source.html.9aaa22f0.js"><link rel="prefetch" href="/assets/backup.html.d47e31fa.js"><link rel="prefetch" href="/assets/sync.html.565f7c71.js"><link rel="prefetch" href="/assets/cannot-update.html.7352ee1a.js"><link rel="prefetch" href="/assets/install-failed.html.20a6531c.js"><link rel="prefetch" href="/assets/package.html.1fb278e9.js"><link rel="prefetch" href="/assets/404.html.2547cdef.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">编写自定义源 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/document/mobile/source/custom-source.html#自定义源信息" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义源信息"><!--[--><!--]--> 自定义源信息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx"><!--[--><!--]--> window.lx <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-version" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.version"><!--[--><!--]--> window.lx.version <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-event-names" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.EVENT_NAMES"><!--[--><!--]--> window.lx.EVENT_NAMES <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-on" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.on"><!--[--><!--]--> window.lx.on <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-send" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.send"><!--[--><!--]--> window.lx.send <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-request" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.request"><!--[--><!--]--> window.lx.request <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/document/mobile/source/custom-source.html#window-lx-utils" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.lx.utils"><!--[--><!--]--> window.lx.utils <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><p>文件请使用 UTF-8 编码格式编写，脚本所用编程语言为 JavaScript，可以使用 ES6+语法，脚本与应用的交互是使用类似事件收发的方式进行，这是一个基本的脚本例子：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@name</span> 测试音乐源
 * <span class="token keyword">@description</span> 我只是一个测试音乐源哦
 * <span class="token keyword">@version</span> 1.0.0
 * <span class="token keyword">@author</span> xxx
 * <span class="token keyword">@homepage</span> http://xxx
 */</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">EVENT_NAMES</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> on<span class="token punctuation">,</span> send <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>lx<span class="token punctuation">;</span>

<span class="token keyword">const</span> qualitys <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">kw</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;128k&quot;</span><span class="token operator">:</span> <span class="token string">&quot;128&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;320k&quot;</span><span class="token operator">:</span> <span class="token string">&quot;320&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">flac</span><span class="token operator">:</span> <span class="token string">&quot;flac&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">httpRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> apis <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">kw</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">musicUrl</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> songmid <span class="token punctuation">}</span><span class="token punctuation">,</span> quality</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">httpRequest</span><span class="token punctuation">(</span><span class="token string">&quot;http://xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 注册应用API请求事件</span>
<span class="token comment">// source 音乐源，可能的值取决于初始化时传入的sources对象的源key值</span>
<span class="token comment">// info 请求附加信息，内容根据action变化</span>
<span class="token comment">// action 请求操作类型，目前只有musicUrl，即获取音乐URL链接，</span>
<span class="token comment">//    当action为musicUrl时info的结构：{type, musicInfo}，</span>
<span class="token comment">//        info.type：音乐质量，可能的值有128k / 320k / flac（取决于初始化时对应源传入的qualitys值中的一个），</span>
<span class="token comment">//        info.musicInfo：音乐信息对象，里面有音乐ID、名字等信息</span>
<span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">EVENT_NAMES</span><span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> source<span class="token punctuation">,</span> action<span class="token punctuation">,</span> info <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调必须返回 Promise 对象</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// action 为 musicUrl 时需要在 Promise 返回歌曲 url</span>
    <span class="token keyword">case</span> <span class="token string">&quot;musicUrl&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> apis<span class="token punctuation">[</span>source<span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">musicUrl</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>musicInfo<span class="token punctuation">,</span> qualitys<span class="token punctuation">[</span>source<span class="token punctuation">]</span><span class="token punctuation">[</span>info<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 脚本初始化完成后需要发送inited事件告知应用</span>
<span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">EVENT_NAMES</span><span class="token punctuation">.</span>inited<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 初始化成功 or 失败</span>
  <span class="token literal-property property">openDevTools</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否打开开发者工具，方便用于调试脚本</span>
  <span class="token literal-property property">sources</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前脚本支持的源</span>
    <span class="token literal-property property">kw</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 支持的源对象，可用key值：kw/kg/tx/wy/mg</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;酷我音乐&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;music&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 目前固定为 music</span>
      <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;musicUrl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 目前固定为 [&#39;musicUrl&#39;]</span>
      <span class="token literal-property property">qualitys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;128k&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;320k&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flac&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 当前脚本的该源所支持获取的Url音质，有效的值有：[&#39;128k&#39;, &#39;320k&#39;, &#39;flac&#39;]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义源信息" tabindex="-1"><a class="header-anchor" href="#自定义源信息" aria-hidden="true">#</a> 自定义源信息</h2><p>文件的开头必须包含以下注释：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@name</span> 测试脚本
 * <span class="token keyword">@description</span> 我只是一个测试脚本
 * <span class="token keyword">@version</span> 1.0.0
 * <span class="token keyword">@author</span> xxx
 * <span class="token keyword">@homepage</span> http://xxx
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@name </code>：源的名字，建议不要过长，24 个字符以内</li><li><code>@description </code>：源的描述，建议不要过长，36 个字符以内，可不填，不填时必须保留 @description</li><li><code>@version</code>：源的版本号，可不填，不填时可以删除 @version</li><li><code>@author </code>：脚本作者名字，可不填，不填时可以删除 @author</li><li><code>@homepage </code>：脚本主页，可不填，不填时可以删除 @homepage</li></ul><h2 id="window-lx" tabindex="-1"><a class="header-anchor" href="#window-lx" aria-hidden="true">#</a> <code>window.lx</code></h2><p>应用为脚本暴露的 API 对象。</p><h3 id="window-lx-version" tabindex="-1"><a class="header-anchor" href="#window-lx-version" aria-hidden="true">#</a> <code>window.lx.version</code></h3><p>自定义源 API 版本，API 变更时此版本号将会更改（新增于 v1.14.0 之后）</p><h3 id="window-lx-event-names" tabindex="-1"><a class="header-anchor" href="#window-lx-event-names" aria-hidden="true">#</a> <code>window.lx.EVENT_NAMES</code></h3><p>常量事件名称对象，发送、注册事件时传入事件名时使用，可用值：</p><table><thead><tr><th>事件名</th><th>描述</th></tr></thead><tbody><tr><td><code>inited</code></td><td>脚本初始化完成后发送给应用的事件名，发送该事件时需要传入以下信息：<code>{status, sources, openDevTools}</code><br><code>status</code>：初始化结果（<code>true</code>成功，<code>false</code>失败）<br><code>openDevTools</code>：是否打开 DevTools，此选项可用于开发脚本时的调试<br><code>sources</code>：支持的源信息对象，<br><code>sources[kw/kg/tx/wy/mg].name</code>：源的名字（目前非必须）<br><code>sources[kw/kg/tx/wy/mg].type</code>：源类型，目前固定值需为<code>music</code><br><code>sources[kw/kg/tx/wy/mg].actions</code>：支持的 actions，由于目前只支持<code>musicUrl</code>，所以固定传<code>[&#39;musicUrl&#39;]</code>即可<br><code>sources[kw/kg/tx/wy/mg].qualitys</code>：该源支持的音质列表，有效的值为<code>[&#39;128k&#39;, &#39;320k&#39;, &#39;flac&#39;]</code>，该字段用于控制应用可用的音质类型</td></tr><tr><td><code>request</code></td><td>应用 API 请求事件名，回调入参：<code>handler({ source, action, info})</code>，回调必须返回<code>Promise</code>对象<br><code>source</code>：音乐源，可能的值取决于初始化时传入的<code>sources</code>对象的源 key 值<br><code>info</code>：请求附加信息，内容根据<code>action</code>变化<br><code>action</code>：请求操作类型，目前只有<code>musicUrl</code>，即获取音乐 URL 链接，需要在 Promise 返回歌曲 url，<code>info</code>的结构：<code>{type, musicInfo}</code>，<code>info.type</code>：音乐质量，可能的值有<code>128k</code> / <code>320k</code> / <code>flac</code>（取决于初始化时对应源传入的<code>qualitys</code>值中的一个），<code>info.musicInfo</code>：音乐信息对象，里面有音乐 ID、名字等信息</td></tr><tr><td><code>updateAlert</code></td><td>显示源更新弹窗，发送该事件时的参数：<code>{log, updateUrl}</code><br><code>log</code>：更新日志，必传，字符串类型，内容可以使用<code>\n</code>换行，最大长度 1024，超过此长度后将被截取超出的部分<br><code>updateUrl</code>：更新地址，用于引导用户去该地址更新源，选传，需为 http 协议的 url 地址，最大长度 1024<br>此事件每次运行脚本只能调用一次（新增）<br>例子：<code>lx.send(lx.EVENT_NAMES.updateAlert, { log: &#39;hello world&#39;, updateUrl: &#39;https://xxx.com&#39; })</code></td></tr></tbody></table><h3 id="window-lx-on" tabindex="-1"><a class="header-anchor" href="#window-lx-on" aria-hidden="true">#</a> <code>window.lx.on</code></h3><p>事件注册方法，应用主动与脚本通信时使用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">event_name</span> 事件名
 * <span class="token keyword">@param</span> <span class="token parameter">handler</span> 事件处理回调 -- 注意：注册的回调必须返回 Promise 对象
 */</span>
window<span class="token punctuation">.</span>lx<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：</strong> 注册的回调必须返回 <code>Promise</code> 对象。</p><h3 id="window-lx-send" tabindex="-1"><a class="header-anchor" href="#window-lx-send" aria-hidden="true">#</a> <code>window.lx.send</code></h3><p>事件发送方法，脚本主动与应用通信时使用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">event_name</span> 事件名
 * <span class="token keyword">@param</span> <span class="token parameter">datas</span> 要传给应用的数据
 */</span>
window<span class="token punctuation">.</span>lx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> datas<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="window-lx-request" tabindex="-1"><a class="header-anchor" href="#window-lx-request" aria-hidden="true">#</a> <code>window.lx.request</code></h3><p>HTTP 请求方法，用于发送 HTTP 请求，此 HTTP 请求方法不受跨域规则限制：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">url</span> 请求的URL
 * <span class="token keyword">@param</span> <span class="token parameter">options</span> 请求选项，可用选项有 method / headers / body / form / formData / timeout
 * <span class="token keyword">@param</span> <span class="token parameter">callback</span> 请求结果的回调 入参：err, resp, body
 * <span class="token keyword">@return</span> 返回一个方法，调用此方法可以终止HTTP请求
 */</span>
<span class="token keyword">const</span> cancelHttp <span class="token operator">=</span> window<span class="token punctuation">.</span>lx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="window-lx-utils" tabindex="-1"><a class="header-anchor" href="#window-lx-utils" aria-hidden="true">#</a> <code>window.lx.utils</code></h3><p>应用提供给脚本的工具方法：</p><ul><li><code>window.lx.utils.buffer.from</code>：对应 Node.js 的 <code>Buffer.from</code></li><li><code>window.lx.utils.buffer.bufToString</code>：Buffer 转字符串 <code>bufToString(buffer, format)</code>，<code>format</code>对应 Node.js <code>Buffer.toString</code>的参数（v1.14.0 之后新增）</li><li><code>window.lx.utils.crypto.aesEncrypt</code>：AES 加密 <code>aesEncrypt(buffer, mode, key, iv)</code></li><li><code>window.lx.utils.crypto.md5</code>：MD5 加密 <code>md5(str)</code></li><li><code>window.lx.utils.crypto.randomBytes</code>：生成随机字符串 <code>randomBytes(size)</code></li><li><code>window.lx.utils.crypto.rsaEncrypt</code>：RSA 加密 <code>rsaEncrypt(buffer, key)</code></li></ul><p>目前仅提供以上工具方法。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 101877376+4399qianye@users.noreply.github.com">4399qianye</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.d704c10f.js" defer></script>
  </body>
</html>
